<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<script type="text/javascript" src="js/zepto.min.js">
			 
		</script>
		<style>
			*{
				margin: 0px;
				padding: 0px;
			}
			
			.content{
				
				padding: 10px;			
			}
			
			.content ul li{
				width: 100%;
				height: 40px;
				line-height: 40px;
				border-bottom: 1px solid #ccc;
			}
		</style>
		<script>
			
		$(function(){

			var windowHeight=$(window).height();  /*获取浏览器高度*/

			var flag=true;

			var page=1;
			
			$(window).scroll(function(){

				//console.log('111');

				var scrollTop=$(this).scrollTop();  /*滚动条距离顶部的高度*/


				var lastChildHeight=$('.list li').last().offset().top;

				

				if((windowHeight+scrollTop)>lastChildHeight){

					if(flag){
						flag=false;  /*改变状态  没有请求完成的时候不在请求数据*/
							console.log('111');
							/*加载请求数据*/
						/*去服务器请求数据*/

						$('.loading').show();

						$.ajax({  
							    url:"http://www.phonegap100.com/appapi.php?a=getPortalList&catid=20&page="+page,  
							    dataType:'jsonp',  
							    data:'',  
							    jsonp:'callback',  
							    success:function(data) {     
										console.log(data);
							    		if(data.result.length==20){

											var  str='';

									    		for (var i=0; i < data.result.length; i++) {
									    			str+='<li>'+data.result[i].title+'</li>';
									    		}

												$('.list').append(str);
												page++;

											   flag=true;
							    		} 

							    		$('.loading').hide();
							    	
							    		
							    },  
							    timeout:8000    /*超时时间*/
						}); 
							

					}

				
				}

			})

		})
		</script>
	</head>
	<body>
		
		
		<div class="content">			
			<ul class="list">
				<li>这是第一个列表1111</li>
				<li>这是第一个列表2222</li>
				<li>这是第一个列表3333</li>
				<li>这是第一个列表4444</li>
				<li>这是第一个列表1111</li>
				<li>这是第一个列表2222</li>
				<li>这是第一个列表3333</li>
				<li>这是第一个列表4444</li>
				<li>这是第一个列表1111</li>
				<li>这是第一个列表2222</li>
				<li>这是第一个列表3333</li>
				<li>这是第一个列表4444</li>
				<li>这是第一个列表1111</li>
				<li>这是第一个列表2222</li>
				<li>这是第一个列表3333</li>
				<li>这是第一个列表4444</li>
				<li>这是第一个列表1111</li>
				<li>这是第一个列表2222</li>
				<li>这是第一个列表3333</li>
				<li>这是第一个列表4444</li>
				<li>这是第一个列表1111111111111111</li>		


			</ul>


			<div class="loading" style="display: none;">
				<img src="loading.gif" alt="加载中">
			</div>
		
		</div>
	</body>
</html>
